---
categories: [Arcaea, 逆向]
date: 2021-7-25 10:00
---

#### 开始打歌时：

将`unk64`设为`max(100-回忆系数*物量,0)`

#### 每次发生音符判定时：

| pure                      | far                     | lost                                 |
| ------------------------- | ----------------------- | ------------------------------------ |
| 将`hit`值增加`2*回忆系数` | 将`hit`值增加`回忆系数` | 将`nonhit`值减少`Lost扣除回忆度`[^1] |

#### 每一定时间[^2]：

令`a`=$2^{-两次更新间的秒数}$

令`b`=$2^{两次更新间的秒数 \times -0.5}$

令`剩余系数`=$回忆系数\times物量\times(1-min(当前时间/总时长,1)) $[^3]

令`note影响`=$((1-a) \times hit) + ((1 - b) \times nonhit) + unk64$

如果$note影响+剩余系数>100$：更新`剩余系数`=$100-note影响$

更新`hit` =$hit \times a$

更新`nonhit`=$nonhit*b$

更新`unk64`=$note影响$

更新`HP`=$note影响+剩余系数$


[^1]: 参见[机制->回忆收集条->Hard->Hard->Lost扣除回忆度](https://wiki.arcaea.cn/index.php/%E6%9C%BA%E5%88%B6#.E5.9B.9E.E5.BF.86.E6.94.B6.E9.9B.86.E6.9D.A1)
[^2]: 在屏幕刷新率为60fps或者设置为禁用高刷的情况下，每一秒执行240次（但不是每1/240秒执行一次）；在屏幕刷新率为120fps并且设置开启高刷的情况下，每一秒执行480次（（可能）不影响结果）
[^3]:总时长：谱面最后一个元素的结束时间+500ms的毫秒形式