---
tags: [Android,SELinux]
date: 2022-12-20 14:00
title: 为安卓编译 SELinux 相关工具
---

## 目标

在Termux环境下编译、安装[SETools](https://github.com/SELinuxProject/setools)以更好分析SELinux

## 做法

先把SETools源码下载下来，装好基础依赖：

```
git clone -b 4.4.0 --depth 1 https://github.com/SELinuxProject/setools.git
pip install setuptools NetworkX Cython
pkg in clang
```

再把SELinux源码下载下来，编译安装其中的两个依赖库：

```
git clone -b 3.4 --depth 1 https://github.com/SELinuxProject/selinux
cd selinux
```

编译过程会遇到一堆坑，这里我已经整合成了diff，可以如下方式打补丁：

```
wget https://young-lord.github.io/files/selinux-compile-termux.diff
git apply selinux-compile-termux.diff
```

然后就可以愉快编译了：

```
cd libselinux
make PREFIX=$PREFIX install
cd ../libsepol
make PREFIX=$PREFIX install
cd ../..
```

接下来是SETools：

```
cd setools
python setup.py build_ext
python setup.py build
python setup.py install --prefix $PREFIX
```

## 使用

```
tsu # 提升为root权限
seinfo # 显示当前SELinux状态
```

## 感想

<del>比编译Linux内核简单多了</del>
