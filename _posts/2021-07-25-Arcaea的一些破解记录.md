---
categories: [Arcaea, 逆向]
date: 2021-7-25 10:00
---

**免责声明：本博文相关内容已涉及 lowiro 的实际利益。本博文内容仅用于个人软件安全研究与学习。请勿将博文内容用于商业或者非法用途，如果阁下愿意继续阅读，请您承诺将为自己的全部行为负责。**

<small><del>[出处](https://wlt.tql.moe)</del></small>

本文基于Arcaea 3.7.0c（及以前的）（或许还会有以后的）版本，arm64-v8a

## 工具

### [IDA](https://hex-rays.com)

一些功能&快捷键：

- 数据库快照：存放数据库的历史更改`Ctrl+Shift+T`
- 

#### 插件

##### [Bindiff](https://www.zynamics.com/software.html)

咕

##### [Keypatch](https://github.com/keystone-engine/keypatch)

咕

### [Frida](https://frida.re/)

咕

### [gdb](https://www.gnu.org/software/gdb/)

<del>众所周知，</del>gdb是一个功能强大的调试器，我们可以用它来调试native层的程序

#### 安装

首先，最好不要用Windows，坑太多了（如果你成功了请教教我）

我们可以用WSL+Ubuntu，以下内容皆基于此基础展开`

由于目标是`aarch64`架构，所以需要多架构的gdb（这也就是不用Windows的原因）。执行`sudo apt install gdb-multiarch`，随后执行`gdb-multiarch`以确定安装成功

gdbserver可以在[Android NDK](https://developer.android.google.cn/ndk/downloads?hl=zh-cn)的`prebuilt/android-arm64/gdbserver/`目录下找到，也可以用[我上传的版本](https://raw.fastgit.org/Young-Lord/Young-Lord.github.io/master/files/gdbserver)（gdbserver 7.11 for arm64，来自NDK 19c for linux）

把gdbserver丢到`/data/local/tmp/`目录下，赋予777权限

#### 连接

手机端打开arc、usb调试开关

（adb可以用Windows上的）使用adb连接手机（有线/无线），输入`adb forward tcp:23946 tcp:23946`

进入shell（`adb shell`），切换root(`su`)

执行``pid=`ps | grep moe | awk '{print $2}'`;echo $pid'``，得到的数字即为arc的PID

执行`cat /proc/$pid/maps | grep cocos | grep '[0-9a-f]*' -o | sed -n '1,1p'`，得到一个16进制数（形如`7f68dcd000`），把他丢python里，记为`base_addr`，这就是so文件的基址<sup>[需要验证]</sup>

执行`/data/local/tmp/gdbserver :23946 --attach $pid`，开启gdb服务端

打开`gdb-multiarch`，输入`target remot localhost:23946`，等待gdb加载（中途的分页按`c`以继续）

加载完成后，光标停留在`(gdb)`后面，此时可以输入指令

#### 使用

进程暂停时输入`c`以恢复进程运行，进程运行时输入`Ctrl+C`以暂停进程

在IDA找到你需要下断点的位置（形如`0x1F3FF`），记作`offset`，进入python，执行`base_addr+offset`，得到一个十进制数（形如`547220276223`），回到gdb输入`b *547220276223（得到的十进制数）`下断点

输入`i reg`可以查看寄存器的值，如果想查看含向量寄存器和浮点寄存器的值，则需要使用`i all-reg`

用`ni`替代`n`，用`si`替代`s`来步进

更多用法可参考其它教程，比如[这篇](https://www.yanbinghu.com/2019/04/20/41283.html)

### [核心破解](https://blog.coderstory.cn/corepatch-official-download/)

需要Xposed框架（作用域：Android系统），用于绕过签名、版本校验（可以直接安装签名错误或没有签名的apk）

下载地址：

- 安卓10-11：<https://github.com/LSPosed/CorePatch/releases/tag/3.5>
- 安卓7-10：<https://www.lanzoux.com/i7z2rqh>
- 安卓4-7：<https://www.lanzoui.com/iaKd1jdk6pi>

### NS相关

#### [hactool](https://github.com/SciresM/hactool)

咕

#### [nx2elf](https://github.com/shuffle2/nx2elf) & [elf2nso](https://github.com/switchbrew/switch-tools)

咕

## 内容

### .so相关

咕

### Frida相关

咕

### gdb相关

貌似没啥x