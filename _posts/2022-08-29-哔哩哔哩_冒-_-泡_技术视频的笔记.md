---
tags: [程序设计,笔记,C++]
date: 2022-8-29 12:30
title: 哔哩哔哩 冒-_-泡 技术视频的笔记
---

## 慢慢填

[视频传送门](https://space.bilibili.com/397145824/video)

## 正文

### [【算法】用位运算加速sqrt](https://www.bilibili.com/video/BV1se4y1Y7sF)

首先，我们要了解`sqrt`的原理：简而言之，就是先将$sqrt(a)=x$转换为求$x^2-a=0$的解。

具体来说，计算机会任取一个$x_0$，并求$x^2-a=0$在$x_0$上的切线（也就是导函数），通过该导函数与 x轴 的交点来逐渐逼近原函数的交点。多次重复以上过程，从而得到误差允许的解。（具体公式如下图）

![逼近正解的示意图](https://s2.loli.net/2022/09/04/vLyO9DWcGRHbPmr.png)

其中，$x_{0+1}$点（也就是D点，或者说$x_1$点）的坐标可以化简为$(x_0+a/x_0)/2$（如果第一个值$x_0$为负数，也很容易看出$x_1$必定为正数）

那么，如何优化呢？若最开始取的$x_0$足够接近正解，我们就可以跳过大量运算。为此，我们要先[了解一下 IEEE 754 浮点数规范](https://zhuanlan.zhihu.com/p/353013671)

可以看到，浮点数是由指数与底数两部分分开存储。因此，我们只需要将指数先除 2，再将底数部分略微调整（此处通过多次实验，可以得出最优底数调整值），即可得到非常近似的结果。

具体代码参看原视频`12:55`处，摘录如下：

```cpp
float mySqrt(float x){
    float a = x;
    unsigned int* p = (unsigned int*)&x; // 用于进行位的运算
    *p = (*p + 0x3f76cf62) >> 1; // 魔数推导详见视频，通过大量随机测试得到结果
    x = (x + a / x) / 2; // 前文所述的逼近正解，这句可以复制多次以更大减小误差
    return x;
}
```
